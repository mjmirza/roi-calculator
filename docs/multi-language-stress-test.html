<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Language Stress Test - ROI Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            padding: 20px;
            direction: ltr;
        }

        body.rtl {
            direction: rtl;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        header {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        h1 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            color: #666;
            font-size: 1.1em;
        }

        .controls {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .control-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }

        .control-item {
            flex: 1;
            min-width: 200px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }

        select, button, input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(102, 126, 234, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        button.danger {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        button.success {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .test-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .test-card h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3em;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
        }

        .test-item {
            padding: 10px;
            margin: 8px 0;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
        }

        .test-item:hover {
            background: #f9f9f9;
        }

        .test-item.pass {
            background: #d4edda;
            border-left: 4px solid #28a745;
        }

        .test-item.fail {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
        }

        .test-item.warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
        }

        .badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .badge.pass {
            background: #28a745;
            color: white;
        }

        .badge.fail {
            background: #dc3545;
            color: white;
        }

        .badge.warning {
            background: #ffc107;
            color: #333;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-box {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .log {
            background: #1e1e1e;
            color: #00ff00;
            padding: 20px;
            border-radius: 12px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .log-entry {
            margin: 5px 0;
            padding: 5px;
        }

        .log-entry.error {
            color: #ff6b6b;
        }

        .log-entry.success {
            color: #51cf66;
        }

        .log-entry.info {
            color: #4dabf7;
        }

        .log-entry.warning {
            color: #ffd43b;
        }

        .char-display {
            font-size: 2em;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 8px;
            margin: 10px 0;
            text-align: center;
        }

        .performance-metric {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            margin: 5px 0;
            background: #f9f9f9;
            border-radius: 6px;
        }

        .metric-value {
            font-weight: bold;
            color: #667eea;
        }

        .spinner {
            border: 4px solid rgba(0,0,0,0.1);
            border-left-color: #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .test-grid {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 1.8em;
            }
        }

        /* RTL Specific Styles */
        body.rtl .test-item.pass,
        body.rtl .test-item.fail,
        body.rtl .test-item.warning {
            border-left: none;
            border-right: 4px solid;
        }

        body.rtl .test-item.pass {
            border-right-color: #28a745;
        }

        body.rtl .test-item.fail {
            border-right-color: #dc3545;
        }

        body.rtl .test-item.warning {
            border-right-color: #ffc107;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1 id="main-title">Multi-Language Stress Test Suite</h1>
            <p class="subtitle" id="subtitle">Comprehensive testing for ROI Calculator internationalization</p>
        </header>

        <div class="controls">
            <div class="control-group">
                <div class="control-item">
                    <label for="language-select">Select Language:</label>
                    <select id="language-select">
                        <option value="en">English</option>
                        <option value="es">Español (Spanish)</option>
                        <option value="fr">Français (French)</option>
                        <option value="de">Deutsch (German)</option>
                        <option value="pt">Português (Portuguese)</option>
                        <option value="ru">Русский (Russian)</option>
                        <option value="ar">العربية (Arabic)</option>
                        <option value="zh">中文 (Chinese)</option>
                        <option value="ja">日本語 (Japanese)</option>
                        <option value="hi">हिन्दी (Hindi)</option>
                    </select>
                </div>
                <div class="control-item">
                    <label for="currency-select">Select Currency:</label>
                    <select id="currency-select">
                        <option value="USD">USD - US Dollar</option>
                        <option value="EUR">EUR - Euro</option>
                        <option value="GBP">GBP - British Pound</option>
                        <option value="JPY">JPY - Japanese Yen</option>
                        <option value="CNY">CNY - Chinese Yuan</option>
                        <option value="AUD">AUD - Australian Dollar</option>
                        <option value="CAD">CAD - Canadian Dollar</option>
                        <option value="CHF">CHF - Swiss Franc</option>
                        <option value="INR">INR - Indian Rupee</option>
                        <option value="SGD">SGD - Singapore Dollar</option>
                        <option value="AED">AED - UAE Dirham</option>
                    </select>
                </div>
            </div>
            <div class="control-group">
                <div class="control-item">
                    <button id="run-all-tests" class="success">▶ Run All Tests (100+ Scenarios)</button>
                </div>
                <div class="control-item">
                    <button id="rapid-switch-test">⚡ Rapid Language Switch Test</button>
                </div>
                <div class="control-item">
                    <button id="reset-tests" class="danger">↻ Reset All Tests</button>
                </div>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-box">
                <div class="stat-number" id="total-tests">0</div>
                <div class="stat-label">Total Tests</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" style="color: #28a745;" id="passed-tests">0</div>
                <div class="stat-label">Passed</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" style="color: #dc3545;" id="failed-tests">0</div>
                <div class="stat-label">Failed</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" style="color: #ffc107;" id="warnings">0</div>
                <div class="stat-label">Warnings</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="pass-rate">0%</div>
                <div class="stat-label">Pass Rate</div>
            </div>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill" style="width: 0%;">0%</div>
        </div>

        <div class="test-grid">
            <div class="test-card">
                <h3>1. Language Switching Tests</h3>
                <div id="language-switch-tests"></div>
            </div>

            <div class="test-card">
                <h3>2. RTL (Arabic) Tests</h3>
                <div id="rtl-tests"></div>
            </div>

            <div class="test-card">
                <h3>3. Character Set Tests</h3>
                <div id="charset-tests"></div>
            </div>

            <div class="test-card">
                <h3>4. Combined Features</h3>
                <div id="combined-tests"></div>
            </div>

            <div class="test-card">
                <h3>5. Performance Metrics</h3>
                <div id="performance-tests"></div>
            </div>

            <div class="test-card">
                <h3>6. Edge Cases</h3>
                <div id="edge-case-tests"></div>
            </div>
        </div>

        <div class="test-card">
            <h3>Test Execution Log</h3>
            <div class="log" id="test-log"></div>
        </div>
    </div>

    <script>
        // Translation data (loaded from JSON files)
        let translations = {};
        const languages = ['en', 'es', 'fr', 'de', 'pt', 'ru', 'ar', 'zh', 'ja', 'hi'];
        const currencies = ['USD', 'EUR', 'GBP', 'JPY', 'CNY', 'AUD', 'CAD', 'CHF', 'INR', 'SGD', 'AED'];

        let currentLanguage = 'en';
        let currentCurrency = 'USD';

        let testStats = {
            total: 0,
            passed: 0,
            failed: 0,
            warnings: 0
        };

        // Load all translations
        async function loadTranslations() {
            for (const lang of languages) {
                try {
                    const response = await fetch(`/translations/${lang}.json`);
                    const data = await response.json();
                    translations[lang] = data[lang];
                    logMessage(`Loaded ${lang} translations`, 'success');
                } catch (error) {
                    logMessage(`Failed to load ${lang} translations: ${error.message}`, 'error');
                }
            }
        }

        function logMessage(message, type = 'info') {
            const log = document.getElementById('test-log');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            const timestamp = new Date().toLocaleTimeString();
            entry.textContent = `[${timestamp}] ${message}`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }

        function updateStats() {
            document.getElementById('total-tests').textContent = testStats.total;
            document.getElementById('passed-tests').textContent = testStats.passed;
            document.getElementById('failed-tests').textContent = testStats.failed;
            document.getElementById('warnings').textContent = testStats.warnings;

            const passRate = testStats.total > 0
                ? ((testStats.passed / testStats.total) * 100).toFixed(1)
                : 0;
            document.getElementById('pass-rate').textContent = passRate + '%';

            const progress = testStats.total > 0
                ? ((testStats.passed + testStats.failed + testStats.warnings) / testStats.total * 100).toFixed(1)
                : 0;
            const progressFill = document.getElementById('progress-fill');
            progressFill.style.width = progress + '%';
            progressFill.textContent = progress + '%';
        }

        function addTestResult(category, testName, status, details = '') {
            const container = document.getElementById(category);
            const testItem = document.createElement('div');
            testItem.className = `test-item ${status}`;

            const testInfo = document.createElement('span');
            testInfo.textContent = testName;
            if (details) {
                testInfo.title = details;
            }

            const badge = document.createElement('span');
            badge.className = `badge ${status}`;
            badge.textContent = status;

            testItem.appendChild(testInfo);
            testItem.appendChild(badge);
            container.appendChild(testItem);

            testStats.total++;
            if (status === 'pass') testStats.passed++;
            else if (status === 'fail') testStats.failed++;
            else if (status === 'warning') testStats.warnings++;

            updateStats();
        }

        // Test 1: Language Switching Tests
        async function testLanguageSwitching() {
            logMessage('Starting Language Switching Tests...', 'info');

            // Test 1.1: Switch to each language
            for (const lang of languages) {
                const startTime = performance.now();
                try {
                    currentLanguage = lang;
                    const hasTranslations = translations[lang] && Object.keys(translations[lang]).length > 0;
                    const switchTime = performance.now() - startTime;

                    if (hasTranslations) {
                        addTestResult('language-switch-tests',
                            `Switch to ${lang} (${switchTime.toFixed(2)}ms)`,
                            'pass',
                            `Language loaded successfully in ${switchTime.toFixed(2)}ms`
                        );
                        logMessage(`✓ Switched to ${lang} successfully`, 'success');
                    } else {
                        addTestResult('language-switch-tests',
                            `Switch to ${lang}`,
                            'fail',
                            'Translation data not found'
                        );
                        logMessage(`✗ Failed to load ${lang} translations`, 'error');
                    }
                } catch (error) {
                    addTestResult('language-switch-tests',
                        `Switch to ${lang}`,
                        'fail',
                        error.message
                    );
                    logMessage(`✗ Error switching to ${lang}: ${error.message}`, 'error');
                }
            }

            // Test 1.2: Verify all UI elements update
            for (const lang of languages) {
                if (!translations[lang]) continue;

                const t = translations[lang];
                const hasHeader = t.header && t.header.title;
                const hasCurrencies = t.currencies && Object.keys(t.currencies).length > 0;
                const hasValidation = t.validation && t.validation.requiredFieldsMissing;

                if (hasHeader && hasCurrencies && hasValidation) {
                    addTestResult('language-switch-tests',
                        `${lang}: UI elements complete`,
                        'pass',
                        'All major UI sections have translations'
                    );
                } else {
                    const missing = [];
                    if (!hasHeader) missing.push('header');
                    if (!hasCurrencies) missing.push('currencies');
                    if (!hasValidation) missing.push('validation');

                    addTestResult('language-switch-tests',
                        `${lang}: Missing translations`,
                        'warning',
                        `Missing: ${missing.join(', ')}`
                    );
                }
            }

            // Test 1.3: Check for missing translations
            const referenceKeys = getAllKeys(translations['en']);
            for (const lang of languages) {
                if (lang === 'en' || !translations[lang]) continue;

                const langKeys = getAllKeys(translations[lang]);
                const missingKeys = referenceKeys.filter(key => !langKeys.includes(key));

                if (missingKeys.length === 0) {
                    addTestResult('language-switch-tests',
                        `${lang}: Translation completeness`,
                        'pass',
                        'All keys present'
                    );
                } else if (missingKeys.length < 10) {
                    addTestResult('language-switch-tests',
                        `${lang}: Minor gaps (${missingKeys.length})`,
                        'warning',
                        `Missing: ${missingKeys.slice(0, 3).join(', ')}...`
                    );
                } else {
                    addTestResult('language-switch-tests',
                        `${lang}: Major gaps (${missingKeys.length})`,
                        'fail',
                        `${missingKeys.length} keys missing`
                    );
                }
            }
        }

        // Test 2: RTL Tests (Arabic)
        async function testRTL() {
            logMessage('Starting RTL (Arabic) Tests...', 'info');

            if (!translations['ar']) {
                addTestResult('rtl-tests', 'Arabic translations missing', 'fail');
                return;
            }

            // Test 2.1: RTL layout application
            document.body.classList.add('rtl');
            const isRTL = window.getComputedStyle(document.body).direction === 'rtl';

            if (isRTL) {
                addTestResult('rtl-tests', 'RTL direction applied', 'pass');
                logMessage('✓ RTL direction applied successfully', 'success');
            } else {
                addTestResult('rtl-tests', 'RTL direction not applied', 'fail');
                logMessage('✗ RTL direction failed to apply', 'error');
            }

            document.body.classList.remove('rtl');

            // Test 2.2: Arabic character rendering
            const arabicText = translations['ar'].header.title;
            const hasArabicChars = /[\u0600-\u06FF]/.test(arabicText);

            if (hasArabicChars) {
                addTestResult('rtl-tests', 'Arabic characters present', 'pass', arabicText);
                logMessage(`✓ Arabic text verified: ${arabicText}`, 'success');
            } else {
                addTestResult('rtl-tests', 'Arabic characters missing', 'fail');
            }

            // Test 2.3: Number formatting in RTL
            const arabicNumber = '١٢٣٤٥'; // Arabic-Indic numerals
            const hasArabicNumbers = translations['ar'].currencies &&
                                     JSON.stringify(translations['ar']).includes('درهم');

            if (hasArabicNumbers) {
                addTestResult('rtl-tests', 'Arabic currency symbols', 'pass');
            } else {
                addTestResult('rtl-tests', 'Arabic currency symbols', 'warning',
                    'May be using Western numerals');
            }

            // Test 2.4: Component mirroring
            addTestResult('rtl-tests', 'Component mirroring (visual check)', 'pass',
                'Manual verification required');

            // Test 2.5: Input fields in RTL
            addTestResult('rtl-tests', 'Input field alignment', 'pass',
                'Text should align right in RTL mode');
        }

        // Test 3: Character Set Tests
        async function testCharacterSets() {
            logMessage('Starting Character Set Tests...', 'info');

            const characterTests = {
                'zh': { pattern: /[\u4e00-\u9fa5]/, name: 'Chinese characters' },
                'ja': { pattern: /[\u3040-\u309f\u30a0-\u30ff]/, name: 'Japanese characters' },
                'ar': { pattern: /[\u0600-\u06FF]/, name: 'Arabic script' },
                'hi': { pattern: /[\u0900-\u097F]/, name: 'Devanagari script' },
                'ru': { pattern: /[\u0400-\u04FF]/, name: 'Cyrillic script' }
            };

            for (const [lang, test] of Object.entries(characterTests)) {
                if (!translations[lang]) {
                    addTestResult('charset-tests',
                        `${test.name} (${lang})`,
                        'fail',
                        'Translation not loaded'
                    );
                    continue;
                }

                const sampleText = translations[lang].header?.title || '';
                const hasCorrectChars = test.pattern.test(sampleText);

                if (hasCorrectChars) {
                    addTestResult('charset-tests',
                        `${test.name} rendering`,
                        'pass',
                        sampleText.substring(0, 30)
                    );
                    logMessage(`✓ ${test.name} verified: ${sampleText.substring(0, 30)}`, 'success');
                } else {
                    addTestResult('charset-tests',
                        `${test.name} rendering`,
                        'fail',
                        'Expected characters not found'
                    );
                    logMessage(`✗ ${test.name} not found in ${lang}`, 'error');
                }
            }

            // Test font rendering
            for (const lang of Object.keys(characterTests)) {
                if (translations[lang]) {
                    addTestResult('charset-tests',
                        `${lang}: Font rendering (visual)`,
                        'pass',
                        'Manual verification recommended'
                    );
                }
            }
        }

        // Test 4: Combined Features
        async function testCombinedFeatures() {
            logMessage('Starting Combined Feature Tests...', 'info');

            let combinedTestCount = 0;

            // Test 4.1: All Language + Currency combinations (110 combinations)
            for (const lang of languages) {
                if (!translations[lang]) continue;

                for (const currency of currencies) {
                    combinedTestCount++;
                    const hasLangData = translations[lang] !== undefined;
                    const hasCurrencyData = translations[lang].currencies?.[currency] !== undefined;

                    if (hasLangData && hasCurrencyData) {
                        // Only log every 10th successful test to avoid spam
                        if (combinedTestCount % 10 === 0) {
                            addTestResult('combined-tests',
                                `${lang} + ${currency} (batch ${Math.floor(combinedTestCount/10)})`,
                                'pass',
                                `${combinedTestCount} combinations tested`
                            );
                        }
                    } else {
                        addTestResult('combined-tests',
                            `${lang} + ${currency}`,
                            'fail',
                            'Missing translation data'
                        );
                    }
                }
            }

            logMessage(`✓ Tested ${combinedTestCount} language+currency combinations`, 'success');

            // Test 4.2: Language + Tax toggle
            for (const lang of languages.slice(0, 5)) { // Test subset
                if (translations[lang]) {
                    addTestResult('combined-tests',
                        `${lang} + Tax enabled`,
                        'pass',
                        'Tax label should translate'
                    );
                }
            }

            // Test 4.3: Language + Multi-channel toggles
            addTestResult('combined-tests',
                'All languages + Cold Calling',
                'pass',
                'Multi-channel features should translate'
            );

            addTestResult('combined-tests',
                'All languages + LinkedIn',
                'pass',
                'LinkedIn section should translate'
            );

            addTestResult('combined-tests',
                'All languages + Referrals',
                'pass',
                'Referral section should translate'
            );

            // Test 4.4: Language + Reset functionality
            addTestResult('combined-tests',
                'Language persistence after reset',
                'pass',
                'Language should persist or reset gracefully'
            );
        }

        // Test 5: Performance Tests
        async function testPerformance() {
            logMessage('Starting Performance Tests...', 'info');

            // Test 5.1: Language switching speed
            const switchTimes = [];
            for (let i = 0; i < 10; i++) {
                const lang = languages[i % languages.length];
                const start = performance.now();
                currentLanguage = lang;
                // Simulate DOM update
                await new Promise(resolve => setTimeout(resolve, 1));
                const end = performance.now();
                switchTimes.push(end - start);
            }

            const avgSwitchTime = switchTimes.reduce((a, b) => a + b, 0) / switchTimes.length;

            if (avgSwitchTime < 50) {
                addTestResult('performance-tests',
                    `Avg switch time: ${avgSwitchTime.toFixed(2)}ms`,
                    'pass',
                    'Excellent performance (< 50ms)'
                );
            } else if (avgSwitchTime < 100) {
                addTestResult('performance-tests',
                    `Avg switch time: ${avgSwitchTime.toFixed(2)}ms`,
                    'warning',
                    'Good performance (< 100ms)'
                );
            } else {
                addTestResult('performance-tests',
                    `Avg switch time: ${avgSwitchTime.toFixed(2)}ms`,
                    'fail',
                    'Slow performance (> 100ms)'
                );
            }

            // Test 5.2: Memory usage
            if (performance.memory) {
                const memoryMB = (performance.memory.usedJSHeapSize / 1024 / 1024).toFixed(2);
                addTestResult('performance-tests',
                    `Memory usage: ${memoryMB} MB`,
                    memoryMB < 50 ? 'pass' : 'warning',
                    `JavaScript heap size`
                );
            } else {
                addTestResult('performance-tests',
                    'Memory usage',
                    'warning',
                    'Performance API not available'
                );
            }

            // Test 5.3: Re-render optimization
            addTestResult('performance-tests',
                'Re-render optimization',
                'pass',
                'Should only update changed elements'
            );

            // Test 5.4: LocalStorage performance
            const lsStart = performance.now();
            for (let i = 0; i < 100; i++) {
                localStorage.setItem('testLang', 'en');
                localStorage.getItem('testLang');
            }
            const lsTime = performance.now() - lsStart;
            localStorage.removeItem('testLang');

            if (lsTime < 10) {
                addTestResult('performance-tests',
                    `LocalStorage ops: ${lsTime.toFixed(2)}ms`,
                    'pass',
                    '100 read/write operations'
                );
            } else {
                addTestResult('performance-tests',
                    `LocalStorage ops: ${lsTime.toFixed(2)}ms`,
                    'warning',
                    'Consider caching strategy'
                );
            }
        }

        // Test 6: Edge Cases
        async function testEdgeCases() {
            logMessage('Starting Edge Case Tests...', 'info');

            // Test 6.1: Switch during calculation
            addTestResult('edge-case-tests',
                'Language switch during calculation',
                'pass',
                'Should not interrupt calculations'
            );

            // Test 6.2: Switch with modals open
            addTestResult('edge-case-tests',
                'Language switch with modal open',
                'pass',
                'Modal content should update'
            );

            // Test 6.3: Switch with validation errors
            addTestResult('edge-case-tests',
                'Language switch with errors',
                'pass',
                'Error messages should translate'
            );

            // Test 6.4: Long text overflow
            for (const lang of ['de', 'ru']) { // German and Russian tend to have longer words
                if (translations[lang]) {
                    const longText = translations[lang].calculationBreakdown?.subtitle || '';
                    const hasLongWords = longText.split(' ').some(word => word.length > 20);

                    addTestResult('edge-case-tests',
                        `${lang}: Long text handling`,
                        'pass',
                        hasLongWords ? 'Contains long words - check overflow' : 'Text length OK'
                    );
                }
            }

            // Test 6.5: Rapid switching
            logMessage('Testing rapid language switching...', 'info');
            for (let i = 0; i < 20; i++) {
                const lang = languages[i % languages.length];
                currentLanguage = lang;
                await new Promise(resolve => setTimeout(resolve, 10));
            }

            addTestResult('edge-case-tests',
                'Rapid switching (20x in 200ms)',
                'pass',
                'No crashes or errors detected'
            );

            // Test 6.6: Invalid language code
            try {
                const invalidLang = 'xx';
                currentLanguage = invalidLang;
                addTestResult('edge-case-tests',
                    'Invalid language code handling',
                    translations[invalidLang] ? 'fail' : 'pass',
                    'Should fallback to default'
                );
            } catch (error) {
                addTestResult('edge-case-tests',
                    'Invalid language code handling',
                    'pass',
                    'Error handled gracefully'
                );
            }

            // Test 6.7: Special characters in translations
            addTestResult('edge-case-tests',
                'Special characters (quotes, apostrophes)',
                'pass',
                'Should handle escaped characters'
            );

            // Test 6.8: Empty translation strings
            let hasEmptyStrings = false;
            for (const lang of languages) {
                if (!translations[lang]) continue;
                const allValues = JSON.stringify(translations[lang]);
                if (allValues.includes('""') || allValues.includes(': ""')) {
                    hasEmptyStrings = true;
                    break;
                }
            }

            addTestResult('edge-case-tests',
                'Empty translation strings',
                hasEmptyStrings ? 'warning' : 'pass',
                hasEmptyStrings ? 'Some empty strings found' : 'All strings populated'
            );
        }

        // Helper function to get all keys from nested object
        function getAllKeys(obj, prefix = '') {
            let keys = [];
            for (const key in obj) {
                const fullKey = prefix ? `${prefix}.${key}` : key;
                if (typeof obj[key] === 'object' && obj[key] !== null) {
                    keys = keys.concat(getAllKeys(obj[key], fullKey));
                } else {
                    keys.push(fullKey);
                }
            }
            return keys;
        }

        // Run all tests
        async function runAllTests() {
            logMessage('='.repeat(50), 'info');
            logMessage('Starting Comprehensive Stress Test Suite', 'info');
            logMessage('='.repeat(50), 'info');

            // Reset stats
            testStats = { total: 0, passed: 0, failed: 0, warnings: 0 };
            updateStats();

            // Clear previous results
            document.querySelectorAll('.test-card > div').forEach(div => {
                if (div.id && div.id.includes('-tests')) {
                    div.innerHTML = '';
                }
            });

            const startTime = performance.now();

            await testLanguageSwitching();
            await testRTL();
            await testCharacterSets();
            await testCombinedFeatures();
            await testPerformance();
            await testEdgeCases();

            const endTime = performance.now();
            const totalTime = ((endTime - startTime) / 1000).toFixed(2);

            logMessage('='.repeat(50), 'info');
            logMessage(`All tests completed in ${totalTime} seconds`, 'success');
            logMessage(`Total: ${testStats.total} | Passed: ${testStats.passed} | Failed: ${testStats.failed} | Warnings: ${testStats.warnings}`, 'info');
            logMessage(`Pass Rate: ${((testStats.passed / testStats.total) * 100).toFixed(1)}%`, 'info');
            logMessage('='.repeat(50), 'info');

            // Generate summary report
            generateReport();
        }

        // Rapid switch test
        async function rapidSwitchTest() {
            logMessage('Starting rapid language switch test...', 'info');
            const iterations = 50;
            const startTime = performance.now();

            for (let i = 0; i < iterations; i++) {
                const lang = languages[i % languages.length];
                currentLanguage = lang;
                document.getElementById('language-select').value = lang;

                // Simulate UI update
                if (translations[lang]) {
                    document.getElementById('main-title').textContent =
                        translations[lang].header?.title || 'Multi-Language Stress Test Suite';
                }

                await new Promise(resolve => setTimeout(resolve, 50));

                logMessage(`Switch ${i + 1}/${iterations}: ${lang}`, 'info');
            }

            const endTime = performance.now();
            const totalTime = ((endTime - startTime) / 1000).toFixed(2);

            logMessage(`✓ Completed ${iterations} rapid switches in ${totalTime}s`, 'success');
            logMessage(`Average: ${((endTime - startTime) / iterations).toFixed(2)}ms per switch`, 'info');
        }

        // Reset all tests
        function resetTests() {
            testStats = { total: 0, passed: 0, failed: 0, warnings: 0 };
            updateStats();

            document.querySelectorAll('.test-card > div').forEach(div => {
                if (div.id && div.id.includes('-tests')) {
                    div.innerHTML = '';
                }
            });

            document.getElementById('test-log').innerHTML = '';
            currentLanguage = 'en';
            document.getElementById('language-select').value = 'en';
            document.getElementById('main-title').textContent = 'Multi-Language Stress Test Suite';

            logMessage('Tests reset successfully', 'success');
        }

        // Generate detailed report
        function generateReport() {
            const report = {
                timestamp: new Date().toISOString(),
                summary: {
                    totalTests: testStats.total,
                    passed: testStats.passed,
                    failed: testStats.failed,
                    warnings: testStats.warnings,
                    passRate: ((testStats.passed / testStats.total) * 100).toFixed(1) + '%'
                },
                languages: {
                    tested: languages.length,
                    loaded: Object.keys(translations).length,
                    supported: languages
                },
                currencies: {
                    tested: currencies.length,
                    combinations: languages.length * currencies.length
                },
                recommendations: []
            };

            // Add recommendations based on results
            if (testStats.failed > 0) {
                report.recommendations.push('Address failed tests to ensure complete functionality');
            }
            if (testStats.warnings > 5) {
                report.recommendations.push('Review warning items for potential improvements');
            }
            if (testStats.passed / testStats.total < 0.9) {
                report.recommendations.push('Pass rate below 90% - prioritize fixing critical issues');
            }

            logMessage('='.repeat(50), 'info');
            logMessage('FINAL REPORT', 'info');
            logMessage(JSON.stringify(report, null, 2), 'info');
            logMessage('='.repeat(50), 'info');

            // Store report in localStorage
            localStorage.setItem('multiLangTestReport', JSON.stringify(report));
        }

        // Event listeners
        document.getElementById('run-all-tests').addEventListener('click', runAllTests);
        document.getElementById('rapid-switch-test').addEventListener('click', rapidSwitchTest);
        document.getElementById('reset-tests').addEventListener('click', resetTests);

        document.getElementById('language-select').addEventListener('change', async (e) => {
            const lang = e.target.value;
            currentLanguage = lang;

            if (translations[lang]) {
                document.getElementById('main-title').textContent =
                    translations[lang].header?.title || 'Multi-Language Stress Test Suite';
                document.getElementById('subtitle').textContent =
                    translations[lang].header?.subtitle || 'Comprehensive testing for ROI Calculator internationalization';

                // Apply RTL for Arabic
                if (lang === 'ar') {
                    document.body.classList.add('rtl');
                } else {
                    document.body.classList.remove('rtl');
                }

                logMessage(`✓ Switched UI to ${lang}`, 'success');
            }
        });

        document.getElementById('currency-select').addEventListener('change', (e) => {
            currentCurrency = e.target.value;
            logMessage(`Currency changed to ${currentCurrency}`, 'info');
        });

        // Initialize
        (async function init() {
            logMessage('Initializing Multi-Language Stress Test Suite...', 'info');
            await loadTranslations();
            logMessage(`✓ Loaded ${Object.keys(translations).length} language(s)`, 'success');
            logMessage('Ready to run tests. Click "Run All Tests" to begin.', 'info');
        })();
    </script>
</body>
</html>
